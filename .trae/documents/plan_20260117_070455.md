# 解决Build Release APK失败问题

## 问题分析

1. **错误信息**：`ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.`

2. **根本原因**：
   - 系统环境变量中未设置JAVA_HOME
   - 系统PATH中未包含Java可执行文件路径
   - 导致Gradle无法找到Java运行时环境

3. **影响范围**：
   - 无法在本地构建Android Release APK
   - 无法在本地运行Gradle命令
   - GitHub Actions工作流不受影响（已配置Java环境）

## 解决方案

### 1. 检查系统中是否安装了Java

**步骤**：
- [ ] 检查系统中是否安装了Java
- [ ] 查看Java版本和安装路径

**命令**：
```bash
# 检查Java是否安装
java -version

# 查看Java安装路径
where java
```

### 2. 安装Java（如果未安装）

**步骤**：
1. 下载Java JDK（推荐使用OpenJDK 21或AdoptOpenJDK）
2. 运行安装程序，按照提示完成安装
3. 记住Java安装路径，例如：`C:\Program Files\Java\jdk-21`

### 3. 配置JAVA_HOME环境变量

**步骤**：
1. 按下 `Win + R` 组合键，输入 `sysdm.cpl`，然后按Enter
2. 点击 `高级` 选项卡，然后点击 `环境变量` 按钮
3. 在 `系统变量` 部分，点击 `新建` 按钮
4. 添加环境变量：
   - 变量名：`JAVA_HOME`
   - 变量值：Java安装路径（例如：`C:\Program Files\Java\jdk-21`）
5. 在 `系统变量` 部分，找到 `Path` 变量，点击 `编辑` 按钮
6. 点击 `新建` 按钮，添加Java可执行文件路径：
   - 例如：`%JAVA_HOME%\bin`
7. 点击 `确定` 保存所有更改

### 4. 验证Java环境配置

**步骤**：
- [ ] 打开新的命令提示符窗口
- [ ] 运行 `java -version` 命令，确认Java已正确安装
- [ ] 运行 `echo %JAVA_HOME%` 命令，确认JAVA_HOME环境变量已正确设置
- [ ] 运行 `where java` 命令，确认Java可执行文件路径已添加到PATH

### 5. 重新尝试构建Release APK

**步骤**：
- [ ] 导航到Android项目目录
- [ ] 运行Gradle构建命令
- [ ] 确认构建成功

**命令**：
```bash
cd d:/study/租赁/android
./gradlew assembleRelease --stacktrace --info
```

## 预期结果

- Java环境配置正确
- JAVA_HOME环境变量已设置
- Java可执行文件路径已添加到PATH
- 能够成功运行 `java -version` 命令
- 能够成功构建Android Release APK
- 构建过程中不再出现JAVA_HOME相关错误

## 注意事项

1. **Java版本**：确保安装的Java版本与Gradle和Android Gradle Plugin兼容（推荐使用Java 17或21）
2. **环境变量生效**：修改环境变量后，需要重新打开命令提示符窗口才能生效
3. **管理员权限**：修改系统环境变量需要管理员权限
4. **Gradle版本**：确保Gradle版本与Android Gradle Plugin版本兼容
5. **构建缓存**：首次构建可能需要较长时间，后续构建会使用缓存加速

通过以上步骤，预计能够解决Build Release APK失败的问题，确保能够在本地成功构建Android Release APK。